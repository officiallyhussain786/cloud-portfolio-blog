---
import Layout from "../../layouts/layout.astro";
import Header from "../../components/Header.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

const sorted = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title="Writing | Hussain">
  <Header />

  <main class="relative min-h-screen bg-black pt-24 md:pt-32 pb-20 px-6 selection:bg-emerald-500/30 overflow-hidden">

    <!-- Background -->
    <div class="absolute inset-0 z-0
      bg-[linear-gradient(to_right,#ffffff02_1px,transparent_1px),
          linear-gradient(to_bottom,#ffffff02_1px,transparent_1px)]
      bg-[size:40px_40px]
      [mask-image:radial-gradient(ellipse_60%_50%_at_50%_50%,#000_70%,transparent_100%)]">
    </div>

    <div class="max-w-3xl mx-auto relative z-10">

      <!-- Header -->
      <section class="flex flex-col gap-8 mb-14">
        <div class="space-y-6">

          <h1 class="text-4xl md:text-5xl font-bold tracking-tighter text-white font-mono uppercase">
            Writing<span class="text-emerald-500">.</span>
          </h1>

          <!-- Filters -->
          <div class="flex flex-wrap gap-2 md:gap-3">
            {["All", "Systems", "Tech", "Reflections"].map((cat) => (
              <button
                data-filter={cat}
                class={`filter-btn
                  px-5 py-2 rounded-full
                  border border-white/5
                  bg-white/[0.03]
                  text-[10px] md:text-xs
                  uppercase tracking-[0.2em]
                  text-white/40
                  transition-all duration-300
                  ${cat === "All" ? "active" : ""}`}
              >
                {cat}
              </button>
            ))}
          </div>

        </div>
      </section>

      <!-- Posts -->
      <section id="posts" class="grid gap-6">

        {sorted.map((post) => (
          <a
            href={`/blog/${post.slug}`}
            data-category={post.data.category}
            class="post-card group relative
              p-6 md:p-8
              rounded-2xl
              border border-white/5
              bg-white/[0.02]
              transition-all duration-500
              hover:bg-white/[0.04]
              hover:border-emerald-500/20"
          >

            <div class="flex flex-col gap-4 relative z-10">

              <div class="flex items-center justify-between text-[10px] font-mono tracking-widest uppercase">
                <span class="text-emerald-500/80">
                  {post.data.category}
                </span>
                <span class="text-white/20">
                  {post.data.pubDate.toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric",
                  })}
                </span>
              </div>

              <div class="space-y-2">
                <h2 class="text-xl md:text-2xl font-bold text-white group-hover:text-emerald-400 transition-colors">
                  {post.data.title}
                </h2>

                <p class="text-sm md:text-base text-white/40 leading-relaxed line-clamp-2 max-w-xl">
                  {post.data.description}
                </p>
              </div>

              <div class="flex items-center gap-2 text-[10px] font-mono text-white/20 uppercase tracking-[0.2em]">
                <span class="group-hover:text-white transition-colors">
                  View Entry
                </span>

                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                  class="translate-x-0 group-hover:translate-x-2 transition-transform">
                  <path d="M5 12h14" />
                  <path d="m12 5 7 7-7 7" />
                </svg>
              </div>

            </div>
          </a>
        ))}

      </section>

    </div>
  </main>
</Layout>

<script>
  const buttons = document.querySelectorAll(".filter-btn");
  const posts = document.querySelectorAll(".post-card");

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const filter = btn.dataset.filter;

      buttons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");

      posts.forEach((card) => {
        const cat = card.dataset.category;

        if (filter === "All" || filter === cat) {
          card.style.display = "block";
        } else {
          card.style.display = "none";
        }
      });
    });
  });
</script>

<style is:global>
  .filter-btn.active {
    background: rgba(16,185,129,0.12) !important;
    border-color: rgba(16,185,129,0.45) !important;
    color: #6ee7b7 !important;
  }
</style>
